var presidenciaveisApp=angular.module("presidenciaveisApp",["angular.filter"]);presidenciaveisApp.config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|data):/)}]),presidenciaveisApp.config(["$httpProvider",function(a){a.defaults.xsrfCookieName="csrftoken",a.defaults.xsrfHeaderName="X-CSRFToken";var o=$("input[name=csrfmiddlewaretoken]").val();a.defaults.headers.post["X-CSRFToken"]=o}]),presidenciaveisApp.controller("PresidenciaveisController",["$scope","$http",function(a,o){function t(){for(var o="",t=0;t<a.propostas.length;t++){var r="0";"favor"==a.propostas[t].selecionado?r="1":"contra"==a.propostas[t].selecionado&&(r="-1"),o+=a.propostas[t].id+":"+r+";"}o="data:text/csv;charset=utf-8,"+(o=o.slice(0,-1)),data=encodeURI(o),a.csv=data}function r(){for(var o=[],t=0;t<a.notas.length;t++)o.push(Math.round(a.notas[t]));return{labels:a.candidatosVisualizar,datasets:[{data:o,label:"Concord칙ncia",backgroundColor:"rgba(0,123,255, 0.2)"}]}}function e(a,o){a.data=o,a.update()}a.bloquear=!1,a.init=function(){o.get("/listar-propostas").then(function(o){a.propostas=o.data,function(a){for(var o=a.length-1;o>0;o--){var t=Math.floor(Math.random()*(o+1)),r=a[o];a[o]=a[t],a[t]=r}}(a.propostas),a.candidatos=[];for(var r={},e=0;e<a.propostas.length;e++){a.propostas[e].selecionado="neutro",-1==a.candidatos.indexOf(a.propostas[e].candidato)&&a.candidatos.push(a.propostas[e].candidato);var s=!1;for(var n in r)if(n==a.propostas[e].area){s=!0;var d=!1;for(var i in r[n])if(i==a.propostas[e].candidato){d=!0,r[n][i]+=1;break}d||(r[n][a.propostas[e].candidato]=1)}s||(r[a.propostas[e].area]={},r[a.propostas[e].area][a.propostas[e].candidato]=1)}for(e=0;e<a.propostas.length;e++)a.propostas[e].valorPonderado=100/r[a.propostas[e].area][a.propostas[e].candidato];a.notas=[],a.candidatosVisualizar=[];for(e=0;e<a.candidatos.length;e++)a.notas.push(0),a.candidatosVisualizar.push(e+1);var p=document.getElementById("myChart");a.radar=new Chart(p,{type:"radar",data:{labels:a.candidatosVisualizar,datasets:[{data:a.notas,label:"Concord칙ncia",backgroundColor:"rgba(0,123,255, 0.2)"}]},options:{}}),t()})},a.alterarPosicionamento=function(o,s){var n=o.candidato;switch(o.selecionado){case"contra":for(var d=0;d<a.candidatos.length;d++)if(n==a.candidatos[d]){a.notas[d]-=o.valorPonderado,"favor"==s&&(a.notas[d]-=o.valorPonderado);break}break;case"neutro":for(d=0;d<a.candidatos.length;d++)if(n==a.candidatos[d]){"favor"==s?a.notas[d]-=o.valorPonderado:"contra"==s&&(a.notas[d]+=o.valorPonderado);break}break;case"favor":for(d=0;d<a.candidatos.length;d++)if(n==a.candidatos[d]){a.notas[d]+=o.valorPonderado,"contra"==s&&(a.notas[d]+=o.valorPonderado);break}}e(a.radar,r()),t()},a.verCandidatos=function(){var t=a.csv.split(",")[1];o.post("/enviar-avaliacoes",t,{headers:{"Content-Type":"application/json"}}).then(function(t){t.data.sucesso?o.get("/listar-candidatos").then(function(o){for(var t=o.data,s=0;s<a.candidatos.length;s++)for(var n=0;n<t.length;n++)a.candidatos[s]==t[n].id&&(a.candidatosVisualizar[s]=t[n].nome);e(a.radar,r()),a.bloquear=!0;for(s=0;s<a.propostas.length;s++)for(n=0;n<t.length;n++)a.propostas[s].candidato==t[n].id&&(a.propostas[s].nomeCandidato=t[n].nome)}):alert("Houve um erro ao carregar os candidatos")})},a.upload=function(){var o=document.getElementById("file-upload").files[0],t=new FileReader;null!=o?(t.onloadend=function(o){var t=o.target.result;if(new RegExp(/^[-\d:;]+$/g).test(t)){for(var r=t.split(";"),e=0;e<r.length;e++)for(var s=r[e].split(":")[0],n=r[e].split(":")[1],d=0;d<a.propostas.length;d++)if(s==a.propostas[d].id){var i=a.propostas[d].selecionado;"-1"==n?a.propostas[d].selecionado="contra":"0"==n?a.propostas[d].selecionado="neutro":"1"==n&&(a.propostas[d].selecionado="favor"),i!=a.propostas[d].selecionado&&a.alterarPosicionamento(a.propostas[d],i);break}a.$apply(),document.getElementById("file-upload").value="",alert("Arquivo carregado com sucesso!")}else alert("Escolha um documento v치lido")},t.readAsBinaryString(o)):alert("Escolha um documento v치lido")}}]);